# Домашнее задание к занятию «Микросервисы: подходы» - `Rashevchenko Mikhail`

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

**<details><summary>Ответ:</summary>**     

Решение -  GitLab CI/CD (GitLab) 

GitLab CI/CD предоставляет все необходимые инструменты для обеспечения непрерывной интеграции и непрерывной поставки, а также удовлетворяет требованиям облачной системы, системы контроля версий Git, автоматических сборок, кастомных настроек и безопасного хранения секретных данных.

Обоснование выбора GitLab CI/CD:

1.  GitLab CI/CD встроен в GitLab:         
    GitLab CI/CD является встроенным в GitLab, что обеспечивает единое хранилище для кода, CI/CD и управления задачами. Это позволяет упростить конфигурацию и взаимодействие между компонентами проекта.

2. Поддержка Git и множество репозиториев:    
   GitLab поддерживает систему контроля версий Git и позволяет создавать неограниченное количество репозиториев, что соответствует требованию иметь репозиторий для каждого сервиса.

3. Автоматические сборки и тестирование:   
   GitLab CI/CD позволяет настроить автоматические сборки для каждого изменения в репозитории (CI), а также тестирование и развертывание (CD). Сборки могут быть запущены по событию из системы контроля версий (например, новый коммит) или по кнопке с указанием параметров (мануальный запуск).

4. Конфигурация и настройки сборок:   
   GitLab CI/CD позволяет создавать настраиваемые пайплайны для сборок. Вы можете привязывать настройки к каждой сборке и создавать шаблоны для различных конфигураций сборок.

5. Безопасное хранение секретных данных:   
   GitLab CI/CD предоставляет возможность хранить секретные данные (пароли, ключи доступа) в зашифрованных переменных среды. Эти переменные могут быть использованы в настройках сборок без их отображения в явном виде.

6. Пользовательские и кастомные шаги:   
   GitLab CI/CD позволяет создавать пользовательские шаги для сборок, что позволяет настроить пайплайн в соответствии с конкретными потребностями проекта.

7. Docker и контейнеры:   
   GitLab CI/CD легко интегрируется с Docker, что позволяет создавать собственные Docker-образы для сборки проектов и их развертывания.

8. Развертывание агентов сборки:   
   GitLab CI/CD поддерживает возможность развертывания агентов сборки (runners) на собственных серверах, что обеспечивает более гибкую настройку и управление средой выполнения сборок.

9. Параллельные сборки и тестирование:    
   GitLab CI/CD позволяет запускать сборки и тестирование параллельно, что обеспечивает оптимизацию времени выполнения процесса CI/CD.


</details>


## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

**<details><summary>Ответ:</summary>**     

Решение -  ELK. Elasticsearch-Logstash-Kibana.

Данный стек позволяет делать всё, что описано в требованиях. Функциональный. Популярный (по нему нет недостатка в документации).

1. Filebeat является эффективным средством сбора данных логирования из файлов и отправки в logstash/elasticsearch.   
2. Logstash в Elastic-стеке сбора логов является инструментом для приёма данных, их преобразования и отправки в кластер БД elasticsearch. Может принимать логи в том числе из stdout приложений.     
3. Elasticsearch - база данных, адаптированная для полнотекстового поиска.   
4. Kibana является эффективным средством визуализации данных логов. Позволяет строить Dashbord'ы для удобства отображения и анализа логов.    
    
</details>


## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

**<details><summary>Ответ:</summary>**     

Решение -  Prometheus + Grafana.

Prometheus собирает метрики от экспортеров и сохраняет их в БД временных рядов. Поддерживает мощный язык запросов PromQL (Prometheus Query Language) для выборки и агрегации метрик. Позволяет формировать правила уведомлений (alerts) на основе выражений PromQL для отправки через Alertmanager

Grafana является одной из самых популярных в мире технологией визуализации, используемой для создания панелей мониторинга. Поддерживает множество источников данных (в том числе prometheus), имеет встроенный функционал оповещений (алёртинга) на пороговые события временных рядов.

В качестве системы оповещений можно использовать AlertManager от Prometheus или AlertManager от Grafana в связке с OnCall.

Для сбора системных метрик хостов можно использовать node_exporter и process_exporter. Для сбора других специфичных метрик (например СУБД или брокеров сообщений) можно воспользоваться рекомендуемыми экспортерами или реализовать собственный. 
    
</details>
